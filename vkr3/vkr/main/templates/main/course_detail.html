{% extends "main/base.html" %}

{% block content %}
<div class="container mt-4">
    <div class="card shadow-sm p-4">
        <h2 class="text-center text-primary">{{ course.title }}</h2>
        <p class="text-muted text-center">{{ course.description }}</p>

        <!-- –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫—É—Ä—Å–æ–º -->
        <div class="d-flex justify-content-center gap-2 mb-4">
            {% if user.is_authenticated %}
                {% if user.is_superuser or user == course.teacher %}
                    <a href="{% url 'main:edit_course' course.id %}" class="btn btn-warning">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
                    <a href="{% url 'main:delete_course' course.id %}" class="btn btn-danger" onclick="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã?');">üóë –£–¥–∞–ª–∏—Ç—å</a>
                {% endif %}
            {% endif %}

            {% if user.role == "student" %}
                {% if user in course.students.all %}
                    <button class="btn btn-success" disabled>‚úÖ –í—ã –∑–∞–ø–∏—Å–∞–Ω—ã</button>
                {% else %}
                    <a href="{% url 'main:enroll_course' course.id %}" class="btn btn-primary">üìö –ó–∞–ø–∏—Å–∞—Ç—å—Å—è</a>
                {% endif %}
            {% endif %}
        </div>
    </div>

    {% if user in course.students.all or user == course.teacher or user.is_superuser %}
        <h3 class="mt-4">üìÇ –£—á–µ–±–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã</h3>

        <!-- –ö–Ω–æ–ø–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –º–∞—Ç–µ—Ä–∏–∞–ª–∞ -->
        {% if user == course.teacher %}
            <a href="{% url 'main:add_course_content' course.id %}" class="btn btn-outline-primary mb-3">‚ûï –î–æ–±–∞–≤–∏—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª</a>
        {% endif %}

        <!-- –°–ø–∏—Å–æ–∫ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ -->
        <div class="mt-3">
            {% for content in contents %}
                <div class="card mb-3 shadow-sm">
                    <div class="card-body">
                        <h5 class="card-title text-primary">{{ content.title }}</h5>
                        <p class="card-text text-muted">{{ content.text_content }}</p>

                        {% if content.files.all %}
                            <h6 class="mt-3">üìé –ü—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:</h6>
                            <ul class="list-group">
                                {% for file in content.files.all %}
                                    <li class="list-group-item d-flex justify-content-between align-items-center">
                                        <span>üìÇ <strong>{{ file.file.name }}</strong></span>
                                        <a href="{{ file.file.url }}" class="btn btn-sm btn-outline-success" download>‚¨áÔ∏è –°–∫–∞—á–∞—Ç—å</a>
                                    </li>
                                {% endfor %}
                            </ul>
                        {% else %}
                            <p class="text-muted">‚ùå –§–∞–π–ª—ã –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã.</p>
                        {% endif %}


                        <!-- –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–∞—Ç–µ—Ä–∏–∞–ª–∞–º–∏ -->
                        {% if user == course.teacher or user.is_superuser %}
                            <div class="mt-3">
                                <a href="{% url 'main:edit_course_material' course.id content.id %}" class="btn btn-sm btn-outline-warning">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
                                <a href="{% url 'main:delete_course_material' course.id content.id %}" class="btn btn-sm btn-outline-danger" onclick="return confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –º–∞—Ç–µ—Ä–∏–∞–ª?');">üóë –£–¥–∞–ª–∏—Ç—å</a>
                            </div>
                        {% endif %}
                    </div>
                </div>
            {% empty %}
                <p class="text-muted">‚ùå –ú–∞—Ç–µ—Ä–∏–∞–ª—ã –µ—â–µ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã.</p>
            {% endfor %}
        </div>
    {% else %}
        <div class="alert alert-info mt-4">
            ‚ùó –í—ã –¥–æ–ª–∂–Ω—ã –∑–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –∫—É—Ä—Å, —á—Ç–æ–±—ã –≤–∏–¥–µ—Ç—å –µ–≥–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ!
        </div>
    {% endif %}
</div>
{% endblock %}
